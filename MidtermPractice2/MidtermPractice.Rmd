---
title: "MidtermPractice"
author: "Lin Xiao"
date: "2025-10-25"
output: html_document
---
## 1. Data

### 1.1 Data Description

Public transit ridership refers to the number of people who use public transportation services, such as buses, trains, subways, trams, and other forms of mass transit, to travel from one place to another. It is an important metric to assess the usage and popularity of public transportation systems in a given area. Understanding public transit ridership is crucial for transportation authorities, city planners, and policymakers because it can help inform decisions about funding, service improvements, and the overall effectiveness of a public transit system. 

This dataset shows the Public Transit Raidership of the US from January 2000 to July 2023, including Date(Monthly) and one **time series** variable(TRANSIT).

```{r import-data}
library(readr)
library(fpp2)
TRANSIT <- read_csv("TRANSIT.csv") 
spec(TRANSIT)
Transit_Raw <- TRANSIT$TRANSIT
Transit_ts_ed <- ts(Transit_Raw, frequency = 12, start = c(2000,1)) 
head(Transit_ts_ed)
tail(Transit_ts_ed)
```

## 2. Data overview

### 2.1 Data Plot

```{r data-plot}
plot(Transit_ts_ed, ylab= "Transit")
```

#### Summarry of Data Plot
- From 2000 to around 2019, the series shows moderate fluctuations with a fairly stable seasonal pattern — ridership levels generally remained within a consistent range, suggesting steady demand for public transit.
- Around early 2020, there is a sharp and dramatic decline in transit usage — a structural break most likely corresponding to the COVID-19 pandemic, which severely reduced mobility and public transportation usage.
-After mid-2020, the series exhibits a gradual recovery trend, though ridership has not yet returned to pre-pandemic levels by the end of the observed period.
- The seasonal variation that was evident before 2020 appears to weaken after the drop, possibly indicating changes in travel behavior or commuting patterns post-pandemic.

#### Because the recent data differ from historical trends and show a sharp decline, data before 2021 were removed to keep only the more stable recent period.. 

```{r remove-data}
Transit_ts <- window(Transit_ts_ed, start = c(2021, 5))

plot(Transit_ts)
```

> The time series plot shows a gradual upward trend in U.S. public transit ridership from 2021 to mid-2023, recovering steadily after a previous drop.
> There are also visible seasonal peaks, indicating recurring periods of higher ridership (e.g., around mid-year).
> Overall, the data show both trend and seasonal variation.

### 2.2 Acf plot

```{r data_Acf_plot}
Acf(Transit_ts)

```

> The ACF plot shows significant positive autocorrelation for the first few lags, which gradually decays to zero around lag 9 and turns slightly negative afterward.
> This pattern confirms that the series has short-term persistence (values close in time are correlated) and mild seasonality, consistent with the observed trend in the time-series plot.
> Hence, Acf plots indicate same result with time series plot the data contain a moderate upward trend and seasonal cycles.

### 2.3 Central Tendency

```{r data_tendency}
# display summary statistics
summary(Transit_ts)
boxplot(Transit_ts,
        main = "Public Transit Raidership of the US from Mar 2021 to Jul 2023",
        col = "skyblue")
```

#### Summary of Statistics and Box Plot Observations

The summary statistics are as follows:

| Statistic | Value |
|------------|-------|
| Minimum    | 374081 |
| 1st Quartile (Q1) | 457292 |
| Median     | 512795 |
| Mean       | 501943 |
| 3rd Quartile (Q3) | 541132 |
| Maximum    | 609180 |

-	The box plot shows that U.S. public transit ridership between March 2021 and July 2023 is relatively stable, with a median around 520,000.
Most values fall within the 450,000–570,000 range, indicating moderate fluctuations and no extreme outliers.

## 3 Accuracy Evaluation Criteria

The forecasting accuracy of each model is evaluated using four common metrics: RMSE, MAE, MAPE, and MASE.
Among them, **MASE (Mean Absolute Scaled Error)** is selected as the primary evaluation criterion, since it provides a scale-free comparison against the Naive benchmark and is less sensitive to extreme values.
RMSE and MAE are included to assess error magnitude and robustness, while MAPE offers an intuitive percentage-based interpretation.

## 4. Models

### 3.1 Decomposition
```{r decomposition}
transit_de <- stl(Transit_ts, s.window = "periodic")
plot(transit_de)

transit_sajs <- seasadj(transit_de)
plot(Transit_ts)
lines(transit_sajs, col="red")

```
> The time series is strongly seasonal, as shown in the decomposition plot where regular peaks and troughs repeat consistently each year. The seasonal component displays a clear monthly pattern, with higher values during mid-year months—likely corresponding to summer seasons or holiday travel periods—and lower ridership during winter months.
> The decomposition is additive, since the magnitude of seasonal fluctuations remains roughly constant across time and does not scale with the overall level of the series.
> The trend component shows a gradual increase from 2021.
> The seasonally adjusted series (red line) confirms a general upward trend with slight decline toward mid-2023, suggesting stabilization after a period of growth.

### 3.2 Naive Method
```{r naive}
naive_forecast <- naive(Transit_ts, 12)
```


#### 3.2.1 Residual Analysis
```{r naive_residual}
naive_residual <- residuals(naive_forecast)
plot(naive_residual, main = "Residuals from Naive Forecast", ylab ="Residuals", xlab = "Year")
abline(h=0, col="red")
```

> The residuals are centered near zero,. These patterns indicate that the Naive model fails to fully account for the seasonal and trend components in this time series.

```{r naive_residuals_his}
hist(naive_residual, main = "Histogram of Naïve Forecast Residuals",
     xlab ="Residuals", col = "skyblue")
```

> Most residuals are near zero → good overall fit.
> A long right tail → model sometimes underestimates large ridership spikes.

```{r naive_residuals_fitted}
plot(as.numeric(naive_forecast$fitted), as.numeric(naive_forecast$residuals),
     main = "Residuals vs Fitted (Naïve Model)",
     xlab = "fitted values", ylab = "Residuals")
abline(h = 0, col = "red")
```

> The residuals are generally centered around zero with no obvious pattern, suggesting that the Naïve model captures the basic structure of the data, though a few outliers and mild heteroscedasticity indicate limited accuracy during certain periods.

```{r naive_residual_ts}
plot(as.numeric(Transit_ts),as.numeric(naive_forecast$residuals),
     main = "Actual Values vs Residuals (Naïve Model)",
     xlab = "Actual Values", ylab = "Residuals",
     type = "p", pch = 19, col = "darkblue", cex= 0.8)
abline(h = 0, col = "red")
```

> Residuals are randomly distributed around zero, indicating no strong bias, though higher actual ridership values show larger residuals.
> This pattern suggests that while the Naïve model captures the overall direction of the data, it struggles to adapt to large fluctuations during peak periods.

```{r naive_residual_acf}
Acf(naive_residual, main="ACF of Residuals - Naïve Forecast")
```

> All autocorrelation spikes fall within the blue confidence bounds, which means that the residuals are not significantly autocorrelated.
> This indicates that the residuals behave like white noise, suggesting that the Naïve model has captured most of the predictable structure in the time series.

#### 3.2.2 Naive Accuracy and forecast Plot

```{r naive_accuracy}
accuracy(naive_forecast)
naive_forecast
plot(naive_forecast)
```

#### This model simply uses the last observed value of the time series as the forecast for the future periods.
- The shaded region represents the forecast intervals, showing increasing uncertainty over time.

#### 3.2 Simple Moving Averages
```{r Simple-moving-averages}
# Compute moving averages of different orders
MA3_forecast <- ma(Transit_ts, order = 3)
MA6_forecast <- ma(Transit_ts, order = 6)
MA9_forecast <- ma(Transit_ts, order = 9)

# Plot original time series
plot(Transit_ts, main = "Simple Moving Averages (Orders 3, 6, 9)",
     ylab = "Public Transit", xlab = "Year", col = "black")

# Add the three moving averages
lines(MA3_forecast, col = "red", lwd = 2)
lines(MA6_forecast, col = "blue", lwd = 2)
lines(MA9_forecast, col = "green", lwd = 2)

# Forecast next 12 month using order 6 
fit_ma6 <- auto.arima(na.omit(MA3_forecast))
forecast_ma3 <- forecast(fit_ma6, h = 12)
lines(forecast_ma3$mean, col = "purple", lwd = 2)

# Optionally add confidence intervals
lines(forecast_ma3$lower[,2], col = "purple", lty = 3)
lines(forecast_ma3$upper[,2], col = "purple", lty = 3)

# Add a legend
legend("bottomleft", 
       legend = c("Actual", "MA(3)", "MA(6)", "MA(9)", "Forecast (MA3)"), 
       col = c("black", "red", "blue", "green", "purple"), 
       lty = c(1, 1, 1, 1, 2), 
       lwd = 2, 
       bty = "n")

```

##### As the moving average order increases, the time series becomes progressively smoother.
- MA(3) closely follows the actual data while slightly reducing short-term fluctuations, effectively retaining most of the seasonal pattern.
- MA(6) provides moderate smoothing, filtering out more noise but beginning to weaken the seasonal variations.
- MA(9) yields the smoothest curve, capturing the overall trend but largely removing seasonal detail.

#### Therefore, MA(3) is selected for forecasting because it provides a good balance between noise reduction and the preservation of important seasonal signals in public transit ridership.

### 3.3 Simple Smoothing

```{r i}
ss_forecast <- ses(Transit_ts, h = 12)
ss_forecast$model
```

#### Model Parameters
- **Alpha (α) = 0.9273**  
  - The smoothing parameter is very high (close to 1), meaning the model gives much more weight to recent observations and quickly adapts to recent changes.
  - This suggests that the data may change rapidly or have short-term fluctuations.

- **Initial State (l₀) = 376776.1973**  
  - This represents the model’s *starting level* estimate at the beginning of the time series.  
  - It acts as the baseline from which the exponential smoothing process begins.  

- **Sigma (σ) = 37902.97**  
  - Measures the standard deviation of forecast errors, reflecting the average variability in residuals.
  - The smaller the sigma, the more consistent and accurate the model fit; a higher sigma indicates higher variability and uncertainty.


#### 3.3.1 Residuals

```{r ss-residuals}
ss_residual <- residuals(ss_forecast)

# plot the residuals
plot(ss_residual, main = "Residuals of Simple Smoothing Forecast", ylab = "residuals")
abline(h=0, col="red")
```

> The residuals fluctuate around zero, indicating no systematic bias in the model. However, the repeating peaks and troughs suggest that some seasonal pattern remains in the residuals — meaning the Simple Exponential Smoothing model has not captured the seasonality in the data.

```{r ss-residuals-hist}
# histogram 
hist(ss_residual, main = "Histogram of SS model Residual", xlab="Residuals", col="lightblue", border="white")
```

> The histogram of residuals from the SES model shows that most residuals are clustered near zero, indicating that the model’s forecasts are generally unbiased and centered correctly.
> However, the distribution is not perfectly symmetric, with a slight skewness visible on the left side.
> This suggests that while the model captures the general pattern of the data well, it may underestimate certain lower values or fail to fully account for occasional large deviations.

```{r ss-residuals-fitted}
# Plot fitted vs residuals
plot(as.numeric(ss_forecast$fitted), as.numeric(ss_forecast$residuals),
     main="Fitted Values vs Residuals (SS Model)",
     xlab="Fitted Values", ylab="Residuals")
abline(h=0, col="red")
```

> The residuals are randomly scattered around zero, indicating no systematic bias, but larger deviations at some fitted values suggest the model underestimates variability in some periods.


```{r ss-residuals-ts}
# Plot real time vs residuals
plot(as.numeric(Transit_ts), as.numeric(ss_forecast$residuals),
     main = "Actual Values vs Residuals (SS Model)",
     xlab = "Actual Values", ylab = "Residuals",
     type = "p", pch = 19, col = "darkblue", cex= 0.8)
abline(h = 0, col = "red")
```

> Residuals are centered around zero but show greater variability at higher actual values, suggesting underfitting during high-demand periods.


```{r ss-residual-acf}
# Plot residuals acf
Acf(ss_residual, main="ACF of Residuals - SS Forecast")
```

> All autocorrelation spikes fall within the blue confidence bounds, which means that the residuals are not significantly autocorrelated.
> This indicates that the residuals behave like white noise, suggesting that the Naïve model has captured most of the predictable structure in the time series.

#### 3.3.2 Accuracy & Forecast plot
```{r ss-accuracy}
accuracy(ss_forecast)
ss_forecast
plot(ss_forecast)
```

##### This flat forecast reflects the model’s level-only nature — SES does not capture trend or seasonality, so it assumes future values will stay close to the recent average level.
> According to the forecast table, the predicted ridership remains constant at around 535,334 for all future months.
> The SES (Simple Exponential Smoothing) model has
  - RMSE = 36,472.15
	- MAE = 29,877.77
	- MAPE = 5.93%
	- MASE = 0.35

> These results suggest that the SES model performs moderately well, maintaining forecast errors within roughly 6% on average, which is acceptable for a dataset with noticeable fluctuations but no clear trend or seasonality.


### 3.4 Holt-Winter

```{r hw}
transit_hw <- hw(Transit_ts)
forecast_hw <- forecast(transit_hw, h = 12)
transit_hw$model
```

> The Holt-Winters additive model captures a mild upward trend and moderate seasonality, but with nearly zero α and β, it updates very slowly, relying mostly on the initial state rather than recent data.

#### 3.4.1 Residual Analysis
```{r hw-residual}
hw_residual = residuals(forecast_hw)

#plot residuals
plot(hw_residual, main = "Residuals from Holt Winter Model", ylab="Residuals", xlab = "Year")
abline(h=0, col="red")
```

> During the early part of the time series (around 2021 to early 2022), the residuals stay close to zero with relatively small fluctuations, indicating that the model fitted the data well during this stable period.
> However, starting from around March 2022, the residuals exhibit several large peaks and troughs, showing greater volatility and alternating positive/negative deviations.

> The model fits well in early periods but fails to track the increased volatility after 2022, indicating limited adaptability to changing seasonal dynamics.


```{r hw-residual-his}
#histogram
hist(hw_residual, main = "Histogram of Holt Winter model Residual", xlab="Residuals", col="lightblue", border="white")
```

> The residuals are centered near zero with a roughly symmetric distribution, showing that the Holt-Winters model fits the data reasonably well without major bias.


```{r hw-residual-fr}
# fitted value vs residuals
plot(as.numeric(fitted(forecast_hw)), as.numeric(hw_residual),
     main="Fitted Values vs Residuals (Holt Winter Model)",
     xlab="Fitted Values", ylab="Residuals")
abline(h=0, col="red")
```

> The residuals cluster near zero with a few mild outliers, suggesting good overall fit and no major heteroscedasticity, though occasional extreme deviations remain.

```{r hw-residual-re}
# real values vs residuals
plot(as.numeric(Transit_ts), as.numeric(hw_residual),
     main = "Actual Values vs Residuals (Holt Winter Model)",
     xlab = "Actual Values", ylab = "Residuals",
     type = "p", pch = 19, col = "darkblue", cex= 0.8)
abline(h = 0, col = "red")
```

> Most residuals stay near zero, showing good model fit, but a few large positive residuals at high actual values suggest minor underestimation during peak periods.

```{r hw-residual-acf}
#ACF plot of residuals
Acf(hw_residual, main="ACF of Residuals - Holt Winter Forecast")
```

> The residuals show no significant autocorrelation, suggesting that the Holt-Winters model has effectively captured the systematic structure in the series.


#### 3.4.2 Accuracy & forecast plot

```{r hw-accuracy}
accuracy(forecast_hw)
forecast_hw
plot(forecast_hw)
```

> The Holt-Winters model shows the accuracy, with an RMSE of 40,313, MAPE of 4.1%, and MASE of 0.45

> This indicates that the model fits the data well and provides reliable short-term forecasts, as the residuals behave approximately like white noise.

> The forecast for Jul 2024 (one year ahead) is approximately 646,940 passengers, with an 80% confidence interval between 604,000 and 690,000.

The Holt-Winters model achieves the highest forecasting accuracy (MAPE ≈ 3%), predicting the time series will reach about 670,000 in one year, with moderate uncertainty in the forecast range.

## 3.5 Accuracy summary

```{r accaracy-table}
# Create accuracy comparison table
model_comparison <- rbind(
  naive = accuracy(naive_forecast),
  ss = accuracy(ss_forecast),
  ma = accuracy(forecast_ma3),
  hw = accuracy(forecast_hw)
)

rownames(model_comparison) <- c( "Naive",  "SS", "Moving Average","Holt Winter")
round(model_comparison[, c("RMSE","MAE","MAPE","MASE")], 3)
```

Choosing **RMSE** as the primary accuracy measure because it penalizes larger errors more heavily, making it useful for identifying models that produce consistent and stable forecasts without large deviations.

Best and Worst Forecast Methods (Based on RMSE)
	- Best: **Moving Average** (RMSE = 7,789.591)
    This model achieved the lowest RMSE, indicating it provides the most accurate and stable forecasts among all tested models.
	-	Worst: **Naïve** (RMSE = 37,238.927)
   The Naïve model performed worst because it simply repeats the last observed value and fails to capture underlying trends or seasonal variations.

##### Overall: The Moving Average model demonstrates the highest forecasting accuracy under the RMSE criterion, while the Naïve model performs the poorest due to its inability to model time-dependent structure in the data.

## 4 Summary

##### The U.S. public transit ridership time series **from 2000 to 2023** shows a stable seasonal pattern with a clear **long-term upward trend** until 2019, followed by a **sharp decline around 2020** due to the COVID-19 pandemic. After this drop, the series exhibits a **gradual recovery trend** but has not yet returned to pre-2020 levels.

##### Based on the forecasting models — particularly the Holt-Winters additive and Moving Average models — transit ridership is projected to continue its moderate **upward trend over the next year**, reaching approximately 660,000 to 680,000 riders by mid-2024. The 95% confidence interval ranges roughly between 540,000 and 740,000, indicating moderate forecast uncertainty. Over the **next two years**, the ridership is expected to **gradually increase**, suggesting a steady post-pandemic recovery, though the levels remain below pre-2020 historical peaks.
