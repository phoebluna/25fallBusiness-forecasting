---
title: "FinalExam"
author: "Lin Xiao"
date: "2025-12-8"
output: html_document
---

## 1. Import Data

### Data Description
The dataset is about unemployment data in the State of NY, and it contains **monthly** information. This project working on forecasting unemployment which helps understand the economic health of a region.

```{r ImportData}
library(readr)
library(fpp2)
library(TTR)
raw_data_csv <- read_csv("Data_NewYorkEdited.csv")
head(raw_data_csv)

spec(raw_data_csv)
ts_unemployed <- ts(raw_data_csv$UnemployedLF, start=c(1976,1), end = c(2019,12), frequency=12)

head(ts_unemployed)
tail(ts_unemployed)
```

## 2. Data Overview

### 2.1 Time Series Plot
```{r timeSeriesPlot}
plot(ts_unemployed, ylab = "UnemployedLF", col= "red")
Acf(ts_unemployed)
```

### 2.2 Summary of time series plot Observations

The time series of **UnmploymentLF from Jan 1976 to Dec 2019** shows several key characteristics:

- **trend:** A gradual downward long-term trend, with unemployment levels decreasing toward the end of the series.

- **Strong seasonality:** No clear seasonality is observed. Instead of seasonal repetition, the series exhibits multi-year cyclical movements.

- **Increasing variability:**Variability is not increasing over time; fluctuations remain relatively consistent, though cycles differ in amplitude across decades. 

Overall, the series displays pronounced long-term cycles and strong persistence, with slow ACF decay indicating long-range dependence rather than seasonal structure. 

### 2.3 Remove data plot and ACF plot 

To generate short-term forecasts (1–2 years), a rolling window of recent data is preferred because the unemployment rate experienced structural changes over the full 40-year span. The period after 2010 is much more stable, with consistent downward movement and lower volatility. Using this window improves model stability and prevents earlier high-variance periods from distorting short-term forecasts.

```{r acfPlot}
unemployed_ts <- window(ts_unemployed, start = c(2010,1))

plot(unemployed_ts, main = "Unemployment Level in Labor Force")

Acf(unemployed_ts)
```

### 2.4 Summary of ACF Plot Observations

The ACF shows very strong and persistent autocorrelation that decays slowly, indicating a non-stationary series with a strong underlying trend. There is no visible seasonal pattern, as correlations do not show repeating peaks at regular lags.

### 2.5 Central Tendency

```{r centralTendency}
# Display summary statistics
summary(unemployed_ts)

# Create a box plot for visualizing distribution
boxplot(unemployed_ts,
        main = "Boxplot of Unemployment (2010–2019)",
        ylab = "unemployment(Percentage)",
        col = "lightblue",
        border = "darkblue")


```

### 2.6 Summary of Statistics and Box Plot Observations

The unemployment rates from 2010–2019 range between 3.8 and 10.1, with a median around 6.25, indicating that half of the values fall between 4.5 and 9.1.
The Boxplot shows a wide IQR, suggesting substantial variability across the decade, and no extreme outliers.
Overall, the distribution indicates that unemployment was generally moderate but fluctuated significantly, consistent with the downward trend seen in the time series.


## 3. Accuracy Evaluation Criteria

For this dataset, MAPE (Mean Absolute Percentage Error) is selected as the primary accuracy metric.
Since the goal is to forecast future unemployment rate and communicate performance in interpretable terms, MAPE provides a clear percentage-based measure of average prediction error.

## 4. Models


### 4.1 Decomposition

```{r decomposition}
#decomposition
stl_decomp <- stl(unemployed_ts, s.window = "periodic")
plot(stl_decomp)
attributes(stl_decomp)

```

- This additive decomposition shows a very strong and regular seasonal pattern, repeating every year with consitent peaks and troughs.

- Seasonal values range about +1 to –1, and High in Jan–Mar, low in Jun–Aug. May caused by early-year layoffs raise unemployment; summer hiring lowers it.


```{r decomposition-plot}
# seasonal adjustment
seasadj(stl_decomp)
# Plot a line on the graph
plot(unemployed_ts)
lines(seasadj(stl_decomp), col="Red")
```

> After removing seasonality, the underlying downward trend becomes clearer, and seasonal fluctuations are moderate but noticeable. 


### 4.2 Naive Model

```{r Naive-model}
# Model output
forecast_naive <- naive(unemployed_ts,12)
plot(forecast_naive, col= 'red')
```

- The naïve model simply uses the last observed value of the time series as the forecast for all future periods.
- The shaded region represents the forecast intervals, showing increasing uncertainty over time.


#### 4.2.1 Residual Analysis


```{r naive-residual}
nv_residual <- residuals(forecast_naive)
plot(nv_residual, main="Residuals from Naïve Forecast", ylab="Residuals", xlab = "Year")
abline(h=0, col="red")
```

> The residuals from the naïve model show clear, repeated patterns rather than random noise, indicating the model is not capturing the underlying structure of the data. This happens because the naïve forecast ignores both trend and seasonality, leading to systematic over- and under-prediction.

```{r naive-residual_histogram}
hist(nv_residual, main="Histogram of Naïve Forecast Residuals",
     xlab="Residuals", col="lightblue", border="white")
```


> The residuals are centered near zero, but the distribution isn’t symmetric.  
> That indicats the Naïve model doesn’t fit the data perfectly — some structure like seasonality is still left in the residuals.



```{r naive-residual-vs-fitted}

plot(as.numeric(fitted(forecast_naive)), as.numeric(nv_residual),
     main = "Residuals vs Fitted (Naïve Model)",
     xlab = "fitted values", ylab = "Residuals")
abline(h = 0, col = "red")
```

> The residuals vs. fitted plot shows clear horizontal banding, meaning the errors cluster at specific levels instead of being randomly scattered. This confirms the naïve model fails to capture the structure of the data and leaves strong patterns in the residuals.

```{r naive-actual-vs-residuals}
plot(as.numeric(unemployed_ts),as.numeric(nv_residual),
     main = "Actual Values vs Residuals (Naïve Model)",
     xlab = "Actual Values", ylab = "Residuals",
     type = "p", pch = 19, col = "darkblue", cex= 0.8)

abline(h = 0, col = "red")
```

> The actual-vs-residuals plot again shows clear horizontal bands, meaning the residuals take only a few repeated values instead of forming a random cloud. This confirms that the naïve model leaves strong structure unexplained and is not capturing the true dynamics of the series.

```{r naive-acf}
Acf(nv_residual, main="ACF of Residuals - Naïve Forecast")
```

> The ACF of the naïve model’s residuals shows strong autocorrelation at many lags, especially early lags, which stay well above the significance bounds. This indicates that the naïve model leaves substantial structure unmodeled, and the residuals are not white noise, confirming poor fit.

#### 4.2.2 Accuracy & Conclusion
```{r naive-accuracy}
accuracy(forecast_naive)
forecast_naive$mean
autoplot(forecast_naive) +
  ggtitle("Naïve Forecast") +
  ylab("Unemployment(Percentage)") +
  xlab("Year") +
  theme_minimal()
```
	
**Accuracy:**
The naïve model performs poorly — its MAPE is about 1.26, meaning it has large relative errors, and the ACF1 value of 0.56 shows strong autocorrelation in residuals (a bad sign). This indicates the model does not capture trend or seasonality.

**What it predicts:**
The naïve model simply predicts that next month’s unemployment rate will be equal to the current month’s rate, offering no meaningful insight beyond repeating the last observed value.


### 4.3 Moving Averages

```{r MA-model}
# Compute moving averages of different orders
MA3_forecast <- ma(unemployed_ts, order = 3)
MA6_forecast <- ma(unemployed_ts, order = 6)
MA9_forecast <- ma(unemployed_ts, order = 9)

# Plot original time series
plot(unemployed_ts, main = "Simple Moving Averages (Orders 3, 6, 9)",
     ylab = "Tourist Arrivals (Thousands)", xlab = "Year", col = "black")

# Add the three moving averages
lines(MA3_forecast, col = "red", lwd = 2)
lines(MA6_forecast, col = "blue", lwd = 2)
lines(MA9_forecast, col = "green", lwd = 2)

# Forecast next 4 quarters using order 6 (bonus)
fit_ma6 <- auto.arima(na.omit(MA6_forecast))
forecast_ma6 <- forecast(fit_ma6, h = 12)
lines(forecast_ma6$mean, col = "purple", lwd = 2)

legend("bottomleft",
       legend = c("Original", "MA(3)", "MA(6)", "MA(9)", "Forecast MA(6)"),
       col = c("black", "red", "blue", "green", "purple"),
       lwd = 2, 
       bty = "n",
       cex = 0.6,
       inset = 0.02)
```

**Observations:**
- As the moving average order increases, the series becomes progressively smoother.  
- The **MA(3)** line (red) still follows most of the short-term fluctuations.  
- The **MA(6)** line (blue) reduces seasonal noise and captures medium-term trends better.  
- The **MA(9)** line (green) is the smoothest, showing the long-term movement but lagging behind actual changes.  
- Using MA(6), the forecast for the next next 12 month predicts stable arrivals with mild variations.

Overall, increasing the order of the moving average reduces short-term noise but delays response to sudden changes in the data.

### 4.3 Simple Smoothing
```{r simple-smooting-model}
ss_forecast <- ses(unemployed_ts, h = 12)
plot(ss_forecast)
ss_forecast$model
```

> The SES model behaves almost like a naïve model because α is extremely close to 1, meaning it heavily tracks the latest value and does not smooth much of the past. This makes SES less suitable for your data, which has a clear long-term downward trend and seasonal structure.

#### 4.3.1 Residual Analysis

```{r SS-residual}
ss_residual <- residuals(ss_forecast)
plot(ss_residual, main="Residuals from Simple Smoothing Forecast", ylab="Residuals", xlab = "Year")
abline(h=0, col="red")
```

> The SES residuals show clear patterns rather than random noise, indicating the model fails to capture important structure in the data. The residuals also exhibit clustered positive and negative runs, confirming SES is not fitting the trend or seasonality well.

```{r SS-residual-histogram}
hist(ss_residual, main = "Histogram of SS model Residual", xlab="Residuals", col="lightblue", border="white")
```

**Observations:**
- The SES residual histogram is roughly centered around zero, showing no clear systematic bias.
- However, the distribution is skewed and not symmetric, confirming that SES does not fully capture the structure in the data.

```{r SS-residual-vs-fitted}

plot(as.numeric(fitted(ss_forecast)), as.numeric(ss_residual),
     main="Fitted Values vs Residuals (SS Model)",
     xlab="Fitted Values", ylab="Residuals")
abline(h=0, col="red")
```

**Observations:**
- The residuals vs. fitted plot shows that the points form clear horizontal bands rather than a random cloud.
- This indicates systematic patterns remain, meaning the SES model still fails to capture important structure in the data.


```{r SS-actual-vs-residuals}
plot(as.numeric(unemployed_ts), as.numeric(ss_residual),
     main = "Actual Values vs Residuals (SS Model)",
     xlab = "Actual Values", ylab = "Residuals",
     type = "p", pch = 19, col = "darkblue", cex= 0.8)
abline(h = 0, col = "red")
```


> The residuals vs. actual values plot shows clear horizontal clustering, meaning the SES model produces repeated residual patterns rather than random noise.
> This indicates the model still fails to capture key structure in the data, so the fit remains inadequate.


```{r ss-acf}
Acf(ss_residual, main="ACF of Residuals - SS Forecast")
```

> The ACF plot shows strong positive autocorrelation at many early lags, meaning the residuals are not behaving like white noise.
> This confirms that the SES model misses important structure in the data and is not an adequate forecasting model.

#### 4.3.2 Accuracy & summary

```{r ss-accuracy}
accuracy(ss_forecast)
ss_forecast
plot(ss_forecast)
```

- The SES model performs very well, with a MAPE of about 1.25%, showing highly accurate short-term predictions. It forecasts the series to stay near 3.99999 over the next year, reflecting a stable level with no trend or seasonality. The positive ACF1 indicates some remaining structure that SES does not fully capture.


### 4.4 Holt-Winters

#### 4.4.1 Holt Winters Model perform
```{r holt-winter-model}
hw_forecast <- hw(unemployed_ts)
forecast_hw <- forecast(hw_forecast, h = 12)
forecast_hw$model
```

- α (alpha) = 0.7758 → The model places substantial weight on recent observations when updating the level.
- β (beta) ≈ 0.164 → The trend component is updated gradually, indicating a relatively stable downward trend.
- γ (gamma) ≈ 1e-04  → The seasonal pattern is very stable over time, with almost no change from year to year.
- σ (sigma) = 0.0898 → Indicates relatively low residual variability.
	

#### 4.4.2 Residual Analysis — Holt–Winters Model

```{r residual-analysis-HW}
hw_residual <- residuals(forecast_hw)

#plot residual
plot(hw_residual, main = "Residuals from Holt Winter Model", ylab="Residuals", xlab = "Year")
abline(h=0, col="red")
```

- The residuals are centered around zero, indicating that the model has no systematic over- or underestimation bias.
- Most residuals within the range of ±0.2, suggesting stable forecast performance.
- A few larger deviations (e.g., around 2017 and 2015) indicate that the model did not fully capture certain short-term irregular shocks.
- There is no visible repeating pattern or autocorrelation, implying that trend and seasonality have been effectively modeled.
	

```{r hw-residual-his}
#histogram
hist(hw_residual, main = "Histogram of Holt Winter model Residual", xlab="Residuals", col="lightblue", border="white")
```

- The residuals are mostly concentrated around zero, indicating that the model has captured the main trend and seasonality effectively.
-	The distribution is slightly right-skewed, with a few larger negative residuals (around −0.2), suggesting that the model slightly underpredicted some observations.
-	Most errors fall within the range of −0.2 to +0.2, implying limited variance and stable forecast performance.

The residual histogram is approximately centered near zero with mild right skewness, confirming that the Holt–Winters model fits the data well overall but slightly underestimates a few low seasonal points.


```{r hw-residual-fitted}
# fitted fitted vs residuals
plot(as.numeric(fitted(forecast_hw)), as.numeric(hw_residual),
     main="Fitted vs Residuals (Holt Winter Model)",
     xlab="Fitted Values", ylab="Residuals")
abline(h=0, col="red")
```

> Residuals are mostly concentrated within ±0.2, indicating that the model provides a close fit to the observed data. 
> Only a few larger residuals appear when fitted values fall between 5 and 6, but no clear systematic pattern is present. 
> This random scatter around zero suggests that the Holt–Winters model captures the main trend and seasonality effectively, with only minor localized errors.

```{r hw-values-residuals}
# real values vs residuals
plot(as.numeric(unemployed_ts), as.numeric(hw_residual),
     main = "Actual Values vs Residuals (Holt Winter Model)",
     xlab = "Actual Values", ylab = "Residuals",
     type = "p", pch = 19, col = "darkblue", cex= 0.8)
abline(h = 0, col = "red")
```

> Most points fall within ±0.2 residuals, indicating the model fits the data well. 
> There are only a few (≈2) larger residuals when actual values are in the 5–6 range, but these are exceptions. 
> Overall, the Holt–Winters model captures the bulk of the trend and seasonal structure with only minor localized errors.


```{r hw-residual-ACF}
#ACF plot of residuals
Acf(hw_residual, main="ACF of Residuals - Holt Winter Forecast")
```

**ACF of Residuals**

- Most ACF spikes fall within the 95% confidence bands, indicating the Holt–Winters model captures most of the serial dependence in the data. 
- However, a few early-lag spikes still exceed the bands, showing that some structure remains unexplained and the residuals are not perfectly white noise.

#### 4.4.3 Accuracy & Summary
```{r hw-accuracy}
accuracy(forecast_hw)
forecast_hw
plot(forecast_hw)
```

**Model Accuracy**
The Holt–Winters additive model provides strong accuracy, with a very low MAPE of about 1.19%, indicating that forecast errors are small on average and the model captures both trend and seasonality well.

**Forecast for the Next Year**
It predicts that unemployment will remain stable over the next year, with point forecasts mostly between 3.94 and 4.05 throughout 2020, showing a slight upward drift but no major changes.

Overall, the model fits the data well, handles seasonal patterns effectively, and produces smooth, realistic forecasts with narrow confidence intervals.

### 4.5 ARIMA
```{r ts-armia}
auto_fit <- auto.arima(unemployed_ts)
attributes(auto_fit)
forecast_arima = forecast(auto_fit,h = 12,level=c(99.5))

forecast_arima$model
```


The automatic ARIMA procedure selected an ARIMA(3,1,0)(2,0,0)12 with drift, meaning the model captures short-term AR structure, a seasonal AR component, and an overall downward trend through differencing and drift. The estimated parameters (ar1 = 0.3529, ar2 = 0.5959, ar3 = –0.2016, sar1 = –0.0679, sar2 = –0.0312) and the small estimated variance (σ² ≈ 0.0036) indicate a stable model fit.

Overall, the model is well-specified for capturing both trend and annual seasonality, and it provides a strong statistical foundation for producing year-ahead forecasts.

#### 4.5.1 Residual
```{r arima-residual}
arima_residual <- residuals(forecast_arima)
plot(arima_residual, main = "Residual of ARIMA", xlab = "Year")
abline(h=0, col="red")
```

> Your residuals fluctuate around 0, which indicates that the model does not systematically over- or under-predict.
> Residuals look like white noise: no visible trend or seasonality.
> There are a few big residual spikes, especially around late 2013 and late 2016, possible unexpected events there.

```{r arima-his-residual}
hist(arima_residual, main = "Histogram of ARIMA model Residual", xlab="Residuals", col="lightblue", border="white")

```

> The shape is roughly centered around zero
> The distribution is fairly symmetric, although not perfectly.
> No extremely heavy tails or skewness.

```{r arima-fitted-residual}

plot(as.numeric(fitted(forecast_arima)), as.numeric(arima_residual),
     main = "Fitted and Residuals of ARIMA Model",
     xlab = "Fitted Values",
     ylab = "Residuals"
     )
abline(h=0, col= "red")
```

> The residuals appear randomly scattered around zero with no clear pattern, suggesting the ARIMA model captures most of the underlying structure in the data. > However, slight clustering at higher fitted values indicates some remaining seasonality or nonlinear effects that the ARIMA model does not fully explain.

```{r arima-realvalue-residuals}

plot(as.numeric(unemployed_ts), as.numeric(arima_residual),
     main = "Real Value vs Residuals of ARIMA",
     xlab = "Real Values",
     ylab = "Residuals"
     )

abline(h = 0, col= "red")
```

> The residuals show no clear pattern across the range of actual unemployment values, suggesting the ARIMA model does not systematically over- or under-predict at specific levels. 
> A small cluster of points at higher actual values hints at slight remaining structure, but overall the residuals behave reasonably randomly around zero.


```{r arima-residuals-ACF}

Acf(arima_residual)
```

> All spikes fall inside the bands, no significant remaining autocorrelation.
> No repeating seasonal pattern and no obvous structure
So overall, the ACF suggests that the ARIMA model has done a reasonable job: the residuals look mostly random, meaning the model has captured the trend and short-term correlation in the data.


#### 4.5.2 Accuracy& Summary

```{r arima-accuracy}
accuracy(forecast_arima)
forecast_arima
plot(forecast_arima, main = "Unemployment Next Year from ARIMA")

forecast_arima_N2 = forecast(auto_fit,h = 24,level=c(99.5))
plot(forecast_arima_N2, main = "Unemployment Next Two Year from ARIMA")
```

- ARIMA’s prediction error is about 0.79%, which is quite good for unemployment forecasting.
- The model forecasts unemployment to stay stable around 3.7–4.2% throughout 2020. This reflects a continuation of the recent stable trend.

ARIMA achieves strong overall accuracy with low error rates (MAPE 0.79%), no bias, and better performance than the naive benchmark, indicating a well-fitted model.

### 5. Accuracy Summary

```{r accuracy-summary}
# Create accuracy comparison table
model_comparison <- rbind(
  naive = accuracy(forecast_naive),
  ss = accuracy(ss_forecast),
  ma = accuracy(forecast_ma6),
  hw = accuracy(forecast_hw),
  arima = accuracy(forecast_arima)
)

rownames(model_comparison) <- c( "Naive",  "SES", "Moving Average","Holt Winter", "ARIMA")
round(model_comparison[, c("RMSE","MAE","MAPE","MASE")], 3)

```

**Best and Worst Models by Metric**

| **Accuracy Measure** | **Best Model** | **Worst Model** | **Interpretation** |
|------------------|----------------|-----------------|--------------------|
| **MAPE** | **Moving Average** | Naïve | MA performs best on a scaled basis, far outperforming all others. |


### 6. Forcast without windows using ARIMA
```{r forcast_arima_wholeset}
auto_fit2 <- auto.arima(ts_unemployed)
attributes(auto_fit2)
forecast_arima2 = forecast(auto_fit2,h = 12,level=c(99.5))
plot(forecast_arima2, main = "Unemployment Next Year from ARIMA without windowing")

accuracy(forecast_arima2)
forecast_arima2

forecast_arima_N2_2 = forecast(auto_fit2,h = 24,level=c(99.5))
forecast_arima_N2_2
plot(forecast_arima_N2_2, main = "Unemployment Next Two Year from ARIMA without windowing")
```

**ARIMA Forecasting Using the Full Historical Series — Summary Analysis**

- Model used -ARIMA(3,1,0)(2,0,0)[12] with drift
  -	Non-seasonal AR(3) and differencing of order 1
  - Seasonal AR(2) with yearly seasonality (period = 12)
  - A drift term, capturing long-term trend
  - This model explicitly picks up both trend + seasonal cycles across the entire 1970–2020 range.

- MAPE ~ 0.76% → extremely accurate (sub-1% error is unusually strong for macro data)

- Forecast Interpretation (Next 1–2 Years)
> Next Year: 4.09->4.69 a slight increase
> Next Two Year: 4.09 - 4.8 Signaling a continued but moderate upward trend.

Overall:
The full-sample ARIMA model suggests unemployment has reached a cyclical bottom and is now expected to rise gradually over the next two years.
However, although the full-sample ARIMA model is statistically accurate, it mixes multiple historical economic regimes and overweights old high-unemployment periods. This leads to biased and less realistic forecasts for today’s labor market. A recent data window better reflects current structural conditions and produces more relevant short-term predictions.

### 7. Summary Conclusion
**Overall**
-In the most recent years, the unemployment rate becomes much more stable, fluctuating within a narrow band around 3.8–4.2% with very consistent seasonality. There is no strong upward or downward trend, and variability is lower than earlier decades, making the series highly predictable in the short term.

**Based on the selected models and forecasts:**
- **Next Year**: Both Holt–Winters and ARIMA predict unemployment will remain stable around 3.8–4.2%, with only minor month-to-month fluctuations and no major upward or downward shifts.
- **Next Two Years**: The models collectively indicate continued stability, with values likely holding in the 3.7–4.3% range, suggesting no significant structural changes in the unemployment trend.

**Rank Model**
  1. Moving Average-  Best accuracy (lowest MAPE).
	2. ARIMA – Highest accuracy, balanced fit, reliable residuals
	3. Holt–Winters Additive – Strong seasonal modeling, good accuracy
	4. Simple Exponential Smoothing (SES) – Reasonable but lacks seasonal structure
	5. Naïve Model – Weakest; fails to capture trend or seasonality






