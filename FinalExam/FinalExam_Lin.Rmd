---
title: "FinalExam"
author: "Lin Xiao"
date: "2025-12-8"
output: html_document
---

## 1. Import Data

### Data Description


```{r ImportData}
library(readr)
library(fpp2)
library(TTR)
raw_data_csv <- read_csv("")
head(raw_data_csv)

spec(raw_data_csv)
ts_ <- ts(raw_data_csv$, start=c(1981,1), frequency=4)

head(ts_)
tail(ts_)
```

## 2. Data Overview

### 2.1 Time Series Plot
```{r timeSeriesPlot}
plot(ts_, ylab = "", col= "red")
Acf(ts_)
```

### 2.2 Summary of time series plot Observations

The time series of **Japan tourist arrivals (1981–2012)** shows several key characteristics:

- **trend:** 

- **Strong seasonality:** 

- **Increasing variability:** 

Overall, 

### 2.3 Remove data plot and ACF plot 

```{r acfPlot}
arrivals_ts <- window(ts_, start = c(1996,1))

plot(arrivals_ts)

Acf(arrivals_ts)
```

### 2.4 Summary of ACF Plot Observations


### 2.5 Central Tendency

```{r centralTendency}
# Display summary statistics
summary(arrivals_ts)

# Create a box plot for visualizing distribution
boxplot(arrivals_ts,
        main = "Boxplot of Japan Tourist Arrivals (1996–2012)",
        ylab = "Number of Arrivals (in thousands)",
        col = "lightblue",
        border = "darkblue")


```

### 2.6 Summary of Statistics and Box Plot Observations



## 3. Accuracy Evaluation Criteria

For this dataset, MAPE (Mean Absolute Percentage Error) is selected as the primary accuracy metric.
Since the goal is to forecast future tourist arrivals and communicate performance in interpretable terms, MAPE provides a clear percentage-based measure of average prediction error.
The Japan tourist arrivals data consist of positive and stable values, making MAPE appropriate and reliable.

## 4. Models


### 4.1 Decomposition

```{r decomposition}
#decomposition
stl_decomp <- stl(, s.window = "periodic")
plot(stl_decomp)
attributes(stl_decomp)

```

- The seasonal component shows a **clear and stable quarterly pattern** throughout the entire period, confirming consistent seasonality in Japan’s tourist arrivals.

-  

> 

```{r decomposition-plot}
# seasonal adjustment
seasadj(stl_decomp)
# Plot a line on the graph
plot()
lines(seasadj(stl_decomp), col="Red")
```

> 


### 4.2 Naive Model

```{r Naive-model}
# Model output
forecast_naive <- naive(,4)
plot(forecast_naive, col= 'red')
```

- The naïve model simply uses the last observed value of the time series as the forecast for all future periods.
- The shaded region represents the forecast intervals, showing increasing uncertainty over time.


#### 4.2.1 Residual Analysis


```{r naive-residual}
nv_residual <- residuals(forecast_naive)
plot(nv_residual, main="Residuals from Naïve Forecast", ylab="Residuals", xlab = "Year")
abline(h=0, col="red")
```

> The residuals are *centered* near zero (no major bias).
> These patterns indicate that the Naïve method **fails** to fully account for the seasonal and trend components in the data.

```{r naive-residual_histogram}
hist(nv_residual, main="Histogram of Naïve Forecast Residuals",
     xlab="Residuals", col="lightblue", border="white")
```


> The residuals are centered near zero, but the distribution isn’t symmetric.  
> That indicats the Naïve model doesn’t fit the data perfectly — some structure like seasonality is still left in the residuals.



```{r naive-residual-vs-fitted}

plot(as.numeric(fitted(forecast_naive)), as.numeric(nv_residual),
     main = "Residuals vs Fitted (Naïve Model)",
     xlab = "fitted values", ylab = "Residuals")
abline(h = 0, col = "red")
```

> Although the residuals are centered around zero, the distribution is not completely symmetric, indicating that the Naïve model does not fully capture the trend or seasonality.
> There is no clear linear pattern, suggesting that there are no strong systematic errors and the residuals are largely random in value.
> However, the residuals show considerable fluctuation, implying that the model’s forecasting accuracy is relatively low.

```{r naive-actual-vs-residuals}
plot(as.numeric(forecast_naive),as.numeric(nv_residual),
     main = "Actual Values vs Residuals (Naïve Model)",
     xlab = "Actual Values", ylab = "Residuals",
     type = "p", pch = 19, col = "darkblue", cex= 0.8)
abline(h = 0, col = "red")
```

> The “Actual vs Residuals” plot conveys a similar interpretation as the “Fitted vs Residuals” plot — the residuals are roughly centered around zero with no strong pattern, but the wide spread suggests the Naïve model does not fully capture the underlying structure of the time series.

```{r naive-acf}
Acf(nv_residual, main="ACF of Residuals - Naïve Forecast")
```

> The ACF plot of residuals shows significant autocorrelation at seasonal lags (e.g., 4, 8, 12), indicating that the Naïve model has not fully captured the underlying seasonal pattern in the time series. Therefore, the residuals are not white noise.

#### 4.2.2 Accuracy & Conclusion
```{r naive-accuracy}
accuracy(forecast_naive)
forecast_naive$mean
autoplot(forecast_naive) +
  ggtitle("Naïve Forecast") +
  ylab("") +
  xlab("") +
  theme_minimal()
```
	
 **Accuracy**


 **Interpretation**
  

 **Conclusion**


### 4.3 Moving Averages

```{r MA-model}
# Compute moving averages of different orders
MA3_forecast <- ma(, order = 3)
MA6_forecast <- ma(, order = 6)
MA9_forecast <- ma(, order = 9)

# Plot original time series
plot(, main = "Simple Moving Averages (Orders 3, 6, 9)",
     ylab = "Tourist Arrivals (Thousands)", xlab = "Year", col = "black")

# Add the three moving averages
lines(MA3_forecast, col = "red", lwd = 2)
lines(MA6_forecast, col = "blue", lwd = 2)
lines(MA9_forecast, col = "green", lwd = 2)

# Forecast next 4 quarters using order 6 (bonus)
fit_ma6 <- auto.arima(na.omit(MA6_forecast))
forecast_ma6 <- forecast(fit_ma6, h = 4)
lines(forecast_ma6$mean, col = "purple", lwd = 2)

legend("bottomleft",
       legend = c("Original", "MA(3)", "MA(6)", "MA(9)", "Forecast MA(6)"),
       col = c("black", "red", "blue", "green", "purple"),
       lwd = 2, 
       bty = "n",
       cex = 0.6,
       inset = 0.02)
```

**Observations:**
- As the moving average order increases, the series becomes progressively smoother.  
- The **MA(3)** line (red) still follows most of the short-term fluctuations.  
- The **MA(6)** line (blue) reduces seasonal noise and captures medium-term trends better.  
- The **MA(9)** line (green) is the smoothest, showing the long-term movement but lagging behind actual changes.  
- Using MA(6), the forecast for the next 4 quarters predicts stable arrivals with mild variations.

Overall, increasing the order of the moving average reduces short-term noise but delays response to sudden changes in the data.

### 4.3 Simple Smoothing
```{r simple-smooting-model}
ss_forecast <- ses(, h = 4)
plot(ss_forecast)
ss_forecast$model
```

**Model Parameters**
- **Alpha (α) = ** 

- **The initial level (≈)**  arrivals.  

- **The estimated sigma of ** 

Overall,

#### 4.3.1 Residual Analysis

```{r SS-residual}
ss_residual <- residuals(ss_forecast)
plot(ss_residual, main="Residuals from Simple Smoothing Forecast", ylab="Residuals", xlab = "Year")
abline(h=0, col="red")
```

> The residuals fluctuate around zero, indicating no systematic bias in the model.
> However, the repeating peaks and troughs suggest that some seasonal pattern remains in the residuals — meaning the Simple Exponential Smoothing model has not captured the seasonality in the data.

```{r SS-residual-histogram}
hist(ss_residual, main = "Histogram of SS model Residual", xlab="Residuals", col="lightblue", border="white")
```

**Observations:**
- The residuals are approximately **centered around zero**, indicating that the SES model does not exhibit a consistent bias in over- or underestimation.
- The distribution is **left-skewed**, with a few large negative residuals extending to around −80, while the right tail is relatively short (up to about +35).
- Most residuals lie between −60 and +20, indicating a moderate spread around the mean.


```{r SS-residual-vs-fitted}

plot(as.numeric(fitted(ss_forecast)), as.numeric(ss_residual),
     main="Fitted Values vs Residuals (SS Model)",
     xlab="Fitted Values", ylab="Residuals")
abline(h=0, col="red")
```

**Observations:**
-The residuals are generally centered around zero, but the scatter shows a concentration of points at both ends of the fitted value range (around 90 and 200).
- A few large negative residuals (around −60) indicate notable overpredictions in some periods.
- The middle range of fitted values (120–160) contains fewer points, suggesting less variation in that range.


```{r SS-actual-vs-residuals}
plot(as.numeric(), as.numeric(ss_residual),
     main = "Actual Values vs Residuals (SS Model)",
     xlab = "Actual Values", ylab = "Residuals",
     type = "p", pch = 19, col = "darkblue", cex= 0.8)
abline(h = 0, col = "red")
```


> The residuals show a clear pattern: large negative values at low actuals and positive clustering at high actuals, indicating that the SES model tends to overestimate during low-demand periods and underestimate during high-demand periods, suggesting it does not fully capture the scale of variation in the data.


```{r ss-acf}
Acf(ss_residual, main="ACF of Residuals - SS Forecast")
```

> The ACF plot of residuals still shows significant spikes at seasonal lags (for example, around lag 4, 8, 12, etc.), indicating that seasonal correlation remains in the residuals.
> This means that the Simple Smoothing (SS) model — which only captures the level of the time series — did not adequately model the seasonal structure present in the data.

#### 4.3.2 Accuracy & summary

```{r ss-accuracy}
accuracy(ss_forecast)
ss_forecast
plot(ss_forecast)
```

- MAPE = 15.86% suggests the forecasts deviate from actual values by about 16% on average, which is acceptable but not highly accurate for short-term forecasting.

The SES model produces reasonable accuracy with a mild underestimation bias and no major residual autocorrelation, but the 15% MAPE indicates limited short-term precision due to its inability to model trend or seasonality.


### 4.4 Holt-Winters

#### 4.4.1 Holt Winters Model perform
```{r holt-winter-model}
hw_forecast <- hw()
forecast_hw <- forecast(hw_forecast, h = 4)
forecast_hw$model
```

- α (alpha) = 0.4588 → 
- β (beta) ≈ 0 → 
- γ (gamma) ≈ 0 → 
- σ (sigma) = 14.73 → 
	
Overall, 
	

#### 4.4.2 Residual Analysis — Holt–Winters Model

```{r residual-analysis-HW}
hw_residual <- residuals(forecast_hw)

#plot residual
plot(hw_residual, main = "Residuals from Holt Winter Model", ylab="Residuals", xlab = "Year")
abline(h=0, col="red")
```

- The residuals are centered around zero, indicating that the model has no systematic over- or underestimation bias.
- Most residuals within the range of ±20, suggesting stable forecast performance.
- A few larger deviations (e.g., around 2003) indicate that the model did not fully capture certain short-term irregular shocks.
- There is no visible repeating pattern or autocorrelation, implying that trend and seasonality have been effectively modeled.
	

```{r hw-residual-his}
#histogram
hist(hw_residual, main = "Histogram of Holt Winter model Residual", xlab="Residuals", col="lightblue", border="white")
```

- The residuals are mostly concentrated around zero, indicating that the model has captured the main trend and seasonality effectively.
-	The distribution is slightly left-skewed, with a few larger negative residuals (around −40), suggesting that the model slightly underpredicted some observations.
-	Most errors fall within the range of −20 to +20, implying limited variance and stable forecast performance.

The residual histogram is approximately centered near zero with mild left skewness, confirming that the Holt–Winters model fits the data well overall but slightly underestimates a few low seasonal points.


```{r hw-residual-fitted}
# fitted fitted vs residuals
plot(as.numeric(fitted(forecast_hw)), as.numeric(hw_residual),
     main="Fitted vs Residuals (Holt Winter Model)",
     xlab="Fitted Values", ylab="Residuals")
abline(h=0, col="red")
```

Residuals are mostly concentrated within ±20, indicating that the model provides a close fit to the observed data. Only a few larger residuals appear when fitted values fall between 120 and 180, but no clear systematic pattern is present. This random scatter around zero suggests that the Holt–Winters model captures the main trend and seasonality effectively, with only minor localized errors.

```{r hw-values-residuals}
# real values vs residuals
plot(as.numeric(), as.numeric(hw_residual),
     main = "Actual Values vs Residuals (Holt Winter Model)",
     xlab = "Actual Values", ylab = "Residuals",
     type = "p", pch = 19, col = "darkblue", cex= 0.8)
abline(h = 0, col = "red")
```

Most points fall within ±20 residuals, indicating the model fits the data well. There are only a few (≈2–4) larger residuals when actual values are in the 100–200 range, but these are exceptions. Overall, the Holt–Winters model captures the bulk of the trend and seasonal structure with only minor localized errors.


```{r hw-residual-ACF}
#ACF plot of residuals
Acf(hw_residual, main="ACF of Residuals - Holt Winter Forecast")
```

**ACF of Residuals**
- The ACF plot of residuals shows that most autocorrelation values fall within the 95% confidence bands.  
- This implies that residuals are **uncorrelated over time**, meeting the assumption of independence.  
- It also suggests that the Holt–Winters model has adequately captured the serial dependence in the original time series.

#### 4.4.3 Accuracy & Summary
```{r hw-accuracy}
accuracy(forecast_hw)
forecast_hw
plot(forecast_hw)
```

**Model Accuracy**


**Forecast for the Next Year**
The model predicts tourist arrivals (in thousands) for next year as follows:
| Quarter | Forecasted Value |
|----------|------------------|
| 2012 Q4 | **90.46** |
| 2013 Q1 | **96.56** |
| 2013 Q2 | **51.76** |
| 2013 Q3 | **89.99** |

The forecast results predict quarterly arrivals between ≈52,000 and 97,000, with the next-year average around 82,000–90,000 passengers. This aligns with the observed downward trend from previous years, suggesting a continued but stabilized low level of tourist arrivals after the earlier decline.

**Summary:**  
The Holt–Winters additive method delivers accurate, stable forecasts and effectively models both trend and seasonal variations,  
making it one of the most suitable approaches for this quarterly tourism dataset.

### 4.5 ARIMA
```{r ts-armia}
auto_fit <- auto.arima()
attributes(auto_fit)
forecast_arima = forecast(auto_fit,h = 5,level=c(99.5))

forecast_arima$model
```

The automatic ARIMA procedure selected the following model: ARIMA(1,0,0)(0,1,1)[4] with drift

#### 4.5.1 Residual
```{r arima-residual}
arima_residual <- residuals(forecast_arima)
plot(arima_residual, main = "Residual of ARIMA", xlab = "Year")
abline(h=0, col="red")
```

> Your residuals fluctuate around 0, which indicates that the model does not systematically over- or under-predict.
> Residuals look like white noise: no visible trend or seasonality.
> There are a few big residual spikes, especially around2003-2004 and 2009-2010, possible unexpected events there.

```{r arima-his-residual}
hist(arima_residual, main = "Histogram of ARIMA model Residual", xlab="Residuals", col="lightblue", border="white")

```

> The shape is roughly centered around zero
> The distribution is fairly symmetric, although not perfectly.
> No extremely heavy tails or skewness.

```{r arima-fitted-residual}

plot(as.numeric(fitted(forecast_arima)), as.numeric(arima_residual),
     main = "Fitted and Residuals of ARIMA Model",
     xlab = "Fitted Values",
     ylab = "Residuals"
     )
abline(h=0, col= "red")
```

> No clear pattern
> centered around zero
> Constant variance
> A few larger residuals appear isolated, may represent short term shocks

```{r arima-realvalue-residuals}

plot(as.numeric(), as.numeric(arima_residual),
     main = "Real Value vs Residuals of ARIMA",
     xlab = "Real Values",
     ylab = "Residuals"
     )

abline(h = 0, col= "red")
```

> Residuals randomly scattered around zero → model is unbiased
> No visible pattern or shape → residuals do not depend on actual values
> Variance is mostly stable across the range, though a few larger residuals appear near high values → acceptable for this dataset.


```{r arima-residuals-ACF}

Acf(arima_residual)
```

> Most spikes fall inside the bands, no significant remaining autocorrelation.
> There is two slightly pike at Lags 6 and 17, but they're still close to the boundary
> No repeating seasonal pattern and no obvous structure
So overall, the ACF suggests that the ARIMA model has done a reasonable job: the residuals look mostly random, meaning the model has captured the trend and short-term correlation in the data.


#### 4.5.2 Accuracy& Summary

```{r arima-accuracy}
accuracy(forecast_arima)

plot(forecast_arima)
```

- ARIMA’s prediction error is about 7%, which is quite good for tourism forecasting. Anything below 10% is considered high accuracy.

ARIMA achieves strong overall accuracy with low error rates (MAPE ~7%), no bias, and better performance than the naive benchmark, indicating a well-fitted model.

### 4.6 Accuracy Summary

```{r accuracy-summary}
# Create accuracy comparison table
model_comparison <- rbind(
  naive = accuracy(),
  ss = accuracy(),
  ma = accuracy(forecast_ma6),
  hw = accuracy(forecast_hw),
  arima = accuracy(forecast_arima)
)

rownames(model_comparison) <- c( "Naive",  "SES", "Moving Average","Holt Winter", "ARIMA")
round(model_comparison[, c("RMSE","MAE","MAPE","MASE")], 3)

```

**Best and Worst Models by Metric**

| **Accuracy Measure** | **Best Model** | **Worst Model** | **Interpretation** |
|------------------|----------------|-----------------|--------------------|
| **MAPE** | **Moving Average** | Naïve | MA performs best on a scaled basis, far outperforming all others. |


### 5. Summary Conclusion
**Overall**
- 

**Based on the selected models and forecasts:**
- **Next Year**: 
- **Next Two Years**: 

Overall, 

**Rank Model**







