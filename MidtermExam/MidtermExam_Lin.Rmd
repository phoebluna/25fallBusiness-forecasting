---
title: "MidtermPractice"
author: "Lin Xiao"
date: "Nov 10, 2025"
output: html_document
---

## Forecasting car sales in the US. 
- Forecasting car sales helps understand the economic health of a region.
- This data set is about car sales from Jan 2019  to Feb 2024 by monthly.

## 1. Import Data


```{r ImportData}
library(readr)
library(fpp2)
library(TTR)

data_csv <- read_csv("TOTALSA.csv")

spec(data_csv)
Raw_data <- data_csv$'Sales Units(in Millions)'

carsales_ts <- ts(Raw_data, frequency = 12, start = c(2019, 1))

head(carsales_ts)

tail(carsales_ts)
```

## 2. Data Overview

### 2.1 Time Series Plot
```{r timeSeriesPlot}
plot(carsales_ts, ylab = "sales unit(in millions)")
```

### 2.2 Summary of time series plot Observations
- From 2019 to early 2020: Sales remained steady at around 17–18 million units.
- Mid-2020: There was a sharp decline, clearly affected by COVID-19, with a low point of about 9 million units.
- 2021 to 2024: Sales gradually recovered but fluctuated, stabilizing around 14–16 million units.
- Trend: Overall, it shows a V-shaped recovery, though sales have not yet fully returned to pre-2019 levels.

Since the earlier data is not representative, this forecasting will keep only the data from **September 2021 onward**.

### 2.3 Remove data plot 

```{r ts-Plot2}
ts_carsales_data <- window(carsales_ts, start = c(2021,9))

plot(ts_carsales_data, ylab = "sales unit(in millions)")
```

> The overall trend shows a gradual upward movement.
> Sales tend to dip around October- Novmember each year, followed by an increase toward the end of the year or early next year.
> sales tend to peak around mid-of year.


### 2.4 ACF plot 

```{r acf-plot}

Acf(ts_carsales_data)
```

**ACF Plot Observations**

- The ACF still shows a gradual decline with positive values in the early lags — consistent with a trending series.

- Weak seasonality 

Overall, the ACF plot supports the earlier findings that the data exhibits **trend** and **seasonal**.

### 2.5 Central Tendency

```{r centralTendency}
# Display summary statistics
summary(ts_carsales_data)

# Create a box plot for visualizing distribution
boxplot(ts_carsales_data,
        main = "Boxplots - Car sales from Sep 2021 - Feb 2024",
        ylab = "sales unit(in millions)",
        col = "lightblue",
        border = "darkblue")

# box plot for visualizing distribution by year
years  <- floor(time(ts_carsales_data))
values <- as.numeric(ts_carsales_data)
df <- data.frame(year = years, value = values)
boxplot(value ~ year, data = df,
        main = "Boxplots by Year - Car sales from Sep 2021 - Feb 2024",
        xlab = "Year", ylab = "sales unit(in millions)",
        col = "lightblue", border = "gray40", outline = TRUE, las = 2, cex.axis = 0.7)
```

### 2.6 Summary of Statistics and Box Plot Observations

- Sales mostly range between 13 – 16 million units, showing moderate variation.
- The mean ≈ median → distribution is roughly symmetric, not strongly skewed.
- No extreme outliers — suggesting a stable, consistent sales pattern.
- Car sales were stable and moderately increasing after 2021, without large shocks.
- A clear upward trend year-to-year: 2021 < 2022 < 2023; 2023–2024 plateau suggests the market reached a new steady level.

From September 2021 to February 2024, U.S. car sales show a steady post-pandemic recovery, rising from around 13 M to 16 M units with stable, low-volatility distribution and no strong outliers.
The year-by-year box plots confirm a positive trend and market stabilization by 2023.

## 3. Accuracy Evaluation Criteria

The forecasting accuracy of each model is evaluated using four common metrics: RMSE, MAE, MAPE, and MASE.

For this dataset, **MAPE (Mean Absolute Percentage Error)** is selected as the primary accuracy metric.
Since the goal is to forecast future sales in interpretable terms, MAPE provides a clear percentage-based measure of average prediction error.


## 4. Models


### 4.1 Decomposition

```{r decomposition}

#decomposition
stl_decomp <- stl(ts_carsales_data, s.window = "periodic")
plot(stl_decomp)
attributes(stl_decomp)

```

- The seasonal component shows a **clear and stable pattern**, peak **around April** and bottom **around October**, throughout the entire period, confirming consistent seasonality.

- The decomposition is additive.


```{r decomposition-plot}
# seasonal adjustment
seasadj(stl_decomp)
# Plot a line on the graph
plot(ts_carsales_data, ylab = "sales unit(in millions)")
lines(seasadj(stl_decomp), col="Red")
```

The seasonally adjusted series (red line) smooths out the periodic ups and downs seen in the original data, but **not too much**, confirming that the time series exhibits **weak seasonal fluctuations**.


### 4.2 Naive Model

```{r Naive-model}
# Model output
carsales_naive <- naive(ts_carsales_data,12)
plot(carsales_naive, ylab = "sales unit(in millions)")
```

- The naïve model simply uses the last observed value of the time series as the forecast for all future periods.
- The shaded region represents the forecast intervals, showing increasing uncertainty over time.


#### 4.2.1 Residual Analysis


```{r naive-residual}
carsales_nv_residual <- residuals(carsales_naive)
plot(carsales_nv_residual, main="Residuals from Naïve Forecast", ylab="Residuals", xlab = "Year")
abline(h=0, col="red")
```

> The residuals are *centered* near zero (no major bias).
> However, there are repeat peak and bottom on this plot, and these patterns indicate that the Naïve method **fails** to fully account for the seasonal and trend components in the data.

```{r naive-residual_histogram}
hist(carsales_nv_residual, main="Histogram of Naïve Forecast Residuals",
     xlab="Residuals", col="lightblue", border="white")
```

> The residuals are centered near zero, but the distribution isn’t symmetric. 
> That indicats the Naïve model doesn’t fit the data perfectly — some structure like seasonality is still left in the residuals.


```{r naive-residual-vs-fitted}
carsales_nv_fitted <- fitted(carsales_naive)

plot(as.numeric(carsales_nv_fitted), as.numeric(carsales_nv_residual),
     main = "Residuals vs Fitted (Naïve Model)",
     xlab = "fitted values", ylab = "Residuals")
abline(h = 0, col = "red")
```

> Although the residuals are centered around zero, the distribution is not completely symmetric, indicating that the Naïve model does not fully capture the trend or seasonality.
> There is no clear linear pattern, suggesting that there are no strong systematic errors and the residuals are largely random in value.
> However, the residuals show considerable fluctuation, implying that the model’s forecasting accuracy is relatively low.

```{r naive-actual-vs-residuals}
plot(as.numeric(ts_carsales_data),as.numeric(carsales_nv_residual),
     main = "Actual Values vs Residuals (Naïve Model)",
     xlab = "Actual Values", ylab = "Residuals",
     type = "p", pch = 19, col = "darkblue", cex= 0.8)
abline(h = 0, col = "red")
```

> The “Actual vs Residuals” plot conveys a similar interpretation as the “Fitted vs Residuals” plot — the residuals are roughly centered around zero with no strong pattern, but the wide spread suggests the Naïve model does not fully capture the underlying structure of the time series.

```{r naive-acf}
Acf(carsales_nv_residual, main="ACF of Residuals - Naïve Forecast")
```

> The ACF of residuals for the Naïve forecast shows that most autocorrelations fall within the 95% confidence limits, indicating that the residuals are largely uncorrelated and behave like white noise. The model adequately captures the short-term dynamics of the series, with only a weak correlation at lag 1 suggesting minor persistence.


#### 4.2.2 Accuracy & Conclusion
```{r naive-accuracy}
accuracy(carsales_naive)
carsales_naive$mean
autoplot(carsales_naive) +
  ggtitle("") +
  ylab("") +
  xlab("Year") +
  theme_minimal()
```

**Naïve method**  uses the last observed value as the forecast for all future periods.
	
 **Accuracy**
- The model performs quite well for a baseline, with MAPE ≈ 3.6%, indicating that the naïve forecast fits recent sales patterns closely.

**Forecasted Value (1 Year Ahead)**
-	The model predicts flat future values (no trend or seasonal change).
-	For all months in next year, the predicted sales = 16.191 million units.
-	This is simply the last observed value repeated across the forecast horizon.
 
**Conclusion**
The Naïve forecast provides a simple benchmark model with easy interpretation but limited predictive capability. It serves as a baseline.

### 4.3 Moving Averages

```{r MA-model}
# Compute moving averages of different orders
MA3_forecast <- ma(ts_carsales_data, order = 3)
MA6_forecast <- ma(ts_carsales_data, order = 6)
MA9_forecast <- ma(ts_carsales_data, order = 9)

# Plot original time series
plot(ts_carsales_data, main = "Simple Moving Averages (Orders 3, 6, 9)",
     ylab = "sales unit(in millions)", xlab = "Year", col = "black")

# Add the three moving averages
lines(MA3_forecast, col = "red", lwd = 2)
lines(MA6_forecast, col = "blue", lwd = 2)
lines(MA9_forecast, col = "green", lwd = 2)

# Forecast next 4 quarters using order 6 (bonus)
fit_ma6 <- auto.arima(na.omit(MA6_forecast))
forecast_ma6 <- forecast(fit_ma6, h = 12)
lines(forecast_ma6$mean, col = "purple", lwd = 2)

legend("topleft",
       legend = c("Original", "MA(3)", "MA(6)", "MA(9)", "Forecast MA(6)"),
       col = c("black", "red", "blue", "green", "purple"),
       lwd = 2, bty = "n")
```

**Observations:**
- As the moving average order increases, the series becomes progressively smoother.  
- The **MA(3)** line (red) still follows most of the short-term fluctuations.  
- The **MA(6)** line (blue) reduces seasonal noise and captures medium-term trends better.  
- The **MA(9)** line (green) is the smoothest, showing the long-term movement but lagging behind actual changes.  
- Using **MA(6)**, the forecast for the next 12 month predicts stable sales with mild variations.

Overall, increasing the order of the moving average reduces short-term noise but delays response to sudden changes in the data.

### 4.3 Simple Smoothing

```{r simple-smooting-model}
ss_carsales <- ses(ts_carsales_data, h = 12)
plot(ss_carsales)
ss_carsales$model
```

**Model Parameters**
- **Alpha (α) = 0.5635**, it assigns moderate weight to recent data (about half).The model reacts reasonably quickly to new changes, but still smooths out short-term fluctuations.

- **The initial level (≈13.0045)**, The SES model begins with an initial estimated sales level of 13.00 million units (around the early period of Sep 2021).

- **The estimated sigma of 0.6269**, On average, actual sales deviate from the fitted values by about 0.63 million units.	A smaller sigma indicates a tighter fit and more reliable model predictions; here, 0.63 shows a moderately accurate fit.

Overall, the SES model uses a moderate smoothing factor (α = 0.56), starts from an initial sales level of 13.00 million, and has a residual standard deviation of ≈ 0.63 million, indicating a fairly stable but responsive forecast model.

#### 4.3.1 Residual Analysis

```{r SS-residual}
ssrs_carsales <- residuals(ss_carsales)
plot(ssrs_carsales, main="Residuals from Simple Smoothing Forecast", ylab="Residuals", xlab = "Year")
abline(h=0, col="red")
```

> The residuals fluctuate around zero, indicating no systematic bias in the model.
> However, the repeating peaks and troughs suggest that some seasonal pattern remains in the residuals — meaning the Simple Exponential Smoothing model has not captured the seasonality in the data.

```{r SS-residual-histogram}
hist(ssrs_carsales, main = "Histogram of SS model Residual", xlab="Residuals", col="lightblue", border="white")
```

> The residuals from the SES model are centered near zero and mostly symmetric, indicating an unbiased and reasonably well-fitting model. The small spread confirms that most forecast errors are random and moderate in size.


```{r SS-residual-vs-fitted}
sscars_fitted <- fitted(ss_carsales)

plot(as.numeric(sscars_fitted), as.numeric(ssrs_carsales),
     main="Fitted Values vs Residuals (SS Model)",
     xlab="Fitted Values", ylab="Residuals")
abline(h=0, col="red")
```

> The residuals are randomly scattered around the red zero line without a clear pattern or curvature, indicating that the model has no systematic bias — the errors don’t consistently increase or decrease with the fitted values. However, there are a few outlier points, suggesting that in some months the model’s forecasts deviated more from the actual sales than usual, possibly due to unexpected market fluctuations or irregular events.


```{r SS-actual-vs-residuals}
plot(as.numeric(ts_carsales_data), as.numeric(ssrs_carsales),
     main = "Actual Values vs Residuals (SS Model)",
     xlab = "Actual Values", ylab = "Residuals",
     type = "p", pch = 19, col = "darkblue", cex= 0.8)
abline(h = 0, col = "red")
```

> The Actual vs. Residuals plot confirms that residuals are randomly distributed with constant variance and no visible bias, supporting that the Simple Exponential Smoothing model provides a good fit overall, aside from a few isolated outliers.


```{r ss-acf}
Acf(ssrs_carsales, main="ACF of Residuals - SS Forecast")
```

> Most of the residual autocorrelations lie within the 95% confidence limits, indicating that the SES model residuals are largely uncorrelated and behave like white noise — confirming that the model adequately captures the data’s underlying structure.

#### 4.3.2 Accuracy & summary

```{r ss-accuracy}
accuracy(ss_carsales)
ss_carsales
plot(ss_carsales)
```

**Accuracy summary**
- The SES model shows strong forecasting accuracy, with a low MAPE (~3%) and low residual autocorrelation, indicating a good fit and reliable short-term forecasts.

**Forecasted Value (One Year Ahead)**
- The model expects car sales to remain stable around 16 million units over the next year, without strong upward or downward movement.

The SES model provides highly accurate short-term forecasts (MAPE ≈ 3%), predicting stable car sales of about 16 million units in the coming year. The residuals show no major autocorrelation, confirming a good model fit, though SES may not fully capture longer-term upward trends.

### 4.4 Holt-Winters

#### 4.4.1 Holt Winters Model perform
```{r holt-winter-model}
hw_forecast <- hw(ts_carsales_data)
forecast_hw <- forecast(hw_forecast, h = 12)
forecast_hw$model
```

**Parameter Value**
- α (Alpha)= 0.0033 Very small，the level component changes very slowly, meaning the model gives little weight to recent observations.
- β (Beta) = 0.0001 Almost zero indicates an almost flat trend, so the model assumes sales are stable over time.
- γ (Gamma) 0.0003 Very small，minimal seasonal adjustment, confirming weak or negligible seasonality.

The smoothing parameters are extremely low, showing that the series is quite stable with no strong seasonality, and the model heavily smooths past data to produce steady forecasts.

#### 4.4.2 Residual Analysis — Holt–Winters Model

```{r residual-analysis-HW}
hw_residual <- residuals(forecast_hw)

#plot residual
plot(hw_residual, main = "Residuals from Holt Winter Model", ylab="Residuals", xlab = "Year")
abline(h=0, col="red")
```

> The residuals from the Holt–Winters model oscillate around zero without clear systematic bias, confirming a reasonable fit. However, mild autocorrelation and one strong negative residual near 2024 indicate that the model slightly underreacts to recent short-term fluctuations.
	

```{r hw-residual-his}
#histogram
hist(hw_residual, main = "Histogram of Holt Winter model Residual", xlab="Residuals", col="lightblue", border="white")
```

> The residual histogram shows a near-normal distribution centered around zero, confirming no major bias in forecasts. Although a few negative outliers exist, the overall pattern suggests that the Holt–Winters model provides stable and reasonably accurate predictions.


```{r hw-residual-fitted}
# fitted fitted vs residuals
plot(as.numeric(fitted(forecast_hw)), as.numeric(hw_residual),
     main="Fitted fitted vs Residuals (Holt Winter Model)",
     xlab="Fitted Values", ylab="Residuals")
abline(h=0, col="red")
```

> The residuals from the Holt–Winters model are randomly distributed around zero, indicating no systematic bias. Almost all points fall within the range +1 and -1, except for one mild outlier at a fitted value around 17, suggesting the model slightly under-predicted a high sales month.

```{r hw-values-residuals}
# real values vs residuals
plot(as.numeric(ts_carsales_data), as.numeric(hw_residual),
     main = "Actual Values vs Residuals (Holt Winter Model)",
     xlab = "Actual Values", ylab = "Residuals",
     type = "p", pch = 19, col = "darkblue", cex= 0.8)
abline(h = 0, col = "red")
```

> The residuals’ random pattern confirms that the Holt–Winters model performs well overall, with no systematic bias in predictions. The single negative outlier near 15.5 indicates a specific month where actual sales were significantly higher than expected — possibly due to an unusual demand spike that the model couldn’t capture.


```{r hw-residual-ACF}
#ACF plot of residuals
Acf(hw_residual, main="ACF of Residuals - Holt Winter Forecast")
```

**ACF of Residuals**
- The ACF plot of residuals shows that all autocorrelation values fall within the 95% confidence bands.  
- This implies that residuals are **uncorrelated over time**, meeting the assumption of independence.  
- It also suggests that the Holt–Winters model has adequately captured the serial dependence in the original time series.

#### 4.4.3 Accuracy & Summary
```{r hw-accuracy}
accuracy(forecast_hw)
forecast_hw
plot(forecast_hw)
```

**Model Accuracy**
- RMSE = 0.5076: The model’s typical error is about 0.5 units — relatively low, indicating a good fit.
- MAE = 0.4126: Average absolute deviation from actual values — shows stable accuracy.
- MAPE= 2.74%: The model’s average percentage error is under 3%, which is very accurate for time series forecasting.
- ACF1 = 0.3369: Some minor autocorrelation remains, meaning small structure in residuals still exists but is not severe.


**Forecast for the Next Year**
The model predicts sales unit(in millions) for next year as follows:
| Month | Forecasted Value |
|----------|------------------|
| Mar 2024 | **16.68** |
| Dec 2024 | **17.26** |
| Feb-Mar 2025 | **17.5** |


**Summary:**  
The Holt–Winters additive model accurately captures both trend and seasonality in the series, achieving a MAPE below 3%. It forecasts a steady rise in the next year, with predicted values increasing from about 16.7 to 17.3, indicating moderate growth with stable model reliability.

### 4.5 Accuracy Summary

```{r accuracy-summary}
# Create accuracy comparison table
model_comparison <- rbind(
  naive = accuracy(carsales_naive),
  ss = accuracy(ss_carsales),
  ma = accuracy(forecast_ma6),
  hw = accuracy(forecast_hw)
)

rownames(model_comparison) <- c( "Naive",  "Simple Smoothing", "Moving Average","Holt Winter")
round(model_comparison[, c("RMSE","MAE","MAPE","MASE")], 3)

```
**Naïve Forecast**
- Assumes the next value will be equal to the most recent observation.
- Very simple baseline model — useful for comparison, especially when data show no clear trend or seasonality.

**Simple Exponential Smoothing (SES)**
- Uses weighted averages of past observations, giving more weight to recent data.
- Effective for short-term forecasts when data have no clear trend or seasonality; smooths out random fluctuations.

**Moving Average (MA)**
- Averages a fixed number of the most recent observations to predict the next value.
- Reduces noise and captures short-term patterns; very effective for stable or stationary data.

**Holt–Winters (Additive)**
- Extends exponential smoothing to include both trend and seasonal components.
- Best for time series with trend and seasonality — adjusts dynamically to both patterns.


**Best and Worst Models by Metric**

| **Accuracy Measure** | **Best Model** | **Worst Model** | **Interpretation** |
|------------------|----------------|-----------------|--------------------|
| **MAPE** | **Moving Average** | Naïve Model | MA performs best on a scaled basis, far outperforming all others. |

The Moving Average model achieves the lowest error values across all metrics (RMSE, MAE, MAPE, and MASE), indicating excellent short-term forecasting accuracy.


### 5. Summary Conclusion
**Overall**
- The time series of car sales shows a gradual upward trend over the historical period.
- There is moderate seasonality, with recurring fluctuations across quarters, suggesting that car sales tend to rise and fall at similar times each year.
- Short-term noise is visible, but the general movement remains increasing and cyclical

**Based on the selected models and forecasts:**
- **Next Year**: Car sales are likely to increase slightly or remain steady in the next year.
- **Next Two Years**: car sales will maintain a stable upward trend over the following two years, consistent with previous seasonal behavior.

**Ranking of Forecasting methods**
1st – Moving Average: Best accuracy (lowest MAPE).
2nd – Holt–Winters (Additive): Robust for trend and seasonality.
3rd – Simple Exponential Smoothing (SES): Good smoothing, handles short-term noise.
4th – Naïve Model: Baseline only.




